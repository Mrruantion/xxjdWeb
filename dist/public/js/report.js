!function(t){var a={};function e(n){if(a[n])return a[n].exports;var i=a[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}e.m=t,e.c=a,e.d=function(t,a,n){e.o(t,a)||Object.defineProperty(t,a,{configurable:!1,enumerable:!0,get:n})},e.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},e.n=function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(a,"a",a),a},e.o=function(t,a){return Object.prototype.hasOwnProperty.call(t,a)},e.p="",e(e.s=8)}({8:function(t,a){var e,n,i,o=$.cookie("tree_path"),s=$.cookie("appkey"),d=1,c={0:"./img/icon-file-s.svg",1:"./img/icon-file-s.svg",2:"./img/icon-file-s1.svg"};function l(){var t=window.innerHeight||document.documentElement.clientHeight,a=$(".header").height(),e=$(".nav").height();$(".weiyun-content").css("height",t-a+"px"),$(".content").css("height",t-e-90+"px")}function r(){local_api._list("document",{u_path:"^"+o+",|"+o,type:"0|1"},"","",1,-1,s,function(t){console.log(t),function(t){var a=[];customers=t;for(var i=0;i<t.length;i++)a.push(t[i].name);var o={view:{showIcon:!0},check:{enable:!1,chkStyle:"checkbox"},data:{simpleData:{enable:!0}},callback:{onClick:function(t,a,i){parseInt(i.id)>-1&&(e=i.id,n=i.treePath,i._name)}}},s=[];for(i=0;i<t.length;i++)s.push({open:!1,id:t[i].id,treePath:t[i].tree_path,pId:t[i].pid,name:t[i].name,u_path:t[i].u_path,icon:c[t[i].type]});$.fn.zTree.init($("#documentTreeAssign"),o,s);var d=t[0].id;if(d>=0){var l=$.fn.zTree.getZTreeObj("documentTreeAssign"),r=l.getNodeByParam("id",d,null);r&&(tree_path=r.treePath,l.selectNode(r),e=r.id,n=r.treePath)}}(t.data)})}l(),window.onresize=l,$(".endTime").datetimepicker({format:"yyyy",language:"zh-CN",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:4,forceParse:0,minView:4,showMeridian:1}),$(".endTime input").val((new Date).format("yyyy")),$(".endTime").hide(),$("#timeType").change(function(){console.log(this.value),2==this.value?$(".endTime").show():$(".endTime").hide()}),$("#typeSelect").change(function(){switch($(".nav-collects>div:not(:first-child)").hide(),i&&(i.fnClearTable(),$("#doc_list").dataTable().fnDestroy(),i=null),d=parseInt(this.value),$("#doc_list thead").empty(),$("#doc_list thead").append(1==d||2==d||3==d?`\n        <tr class="tops">\n            <th width="10px" style="">\n                序号\n            </th>\n            <th width="120px" style="">\n                ${1==d?"分类名":2==d?"位置":3==d?"时间":""}\n            </th>\n            <th width="120px">\n                案卷数量\n            </th>\n        </tr>\n        `:4==d?'\n        <tr class="tops">\n            <th width="30px" style="">\n                序号\n            </th>\n            <th width="210px" style="">\n                案卷名\n            </th>\n            <th width="150px">\n                档号\n            </th>\n            <th width="120px">\n                保存年限\n            </th>\n            <th width="180px">\n                具体地址\n            </th>\n            <th width="180px">\n                位置\n            </th>\n            <th width="120px">\n                社区单位编号\n            </th>\n            <th width="50px">\n                件数\n            </th>\n            <th width="50px">\n                页数\n            </th>\n        </tr>':5==d?'\n        <tr class="tops">\n            <th width="30px" style="">\n                序号\n            </th>\n            <th width="210px" style="">\n                操作\n            </th>\n            <th width="150px">\n                操作人\n            </th>\n            <th width="120px">\n                操作账号\n            </th>\n            <th width="180px">\n                操作时间\n            </th>\n        </tr>':void 0),parseInt(this.value)){case 1:$("#classify").parent().show(),r();break;case 2:$("#position").parent().show();break;case 3:$("#datetime").show();break;case 4:$("#classify").parent().show(),r();break;case 5:local_api._list("syslog",{u_path:"^"+$.cookie("tree_path")},"","-createdAt",1,-1,$.cookie("appkey"),function(t){h(t,5)})}}),r(),$("#divDocumentAssign").dialog({width:400,maxHeight:400,autoOpen:!1,title:"分类",buttons:{"确定":function(){var t,a;1==d?local_api._list("document",{tree_path:"^"+n,id:">"+e},"","",1,-1,s,function(t){for(var a=dataControl.getChildById(t.data,e),n=0;n<a.length;n++)a[n].count=dataControl.getChildren(t.data,a[n].id,!0).filter(function(t){return 2==t.type}).length;var i={data:a,total:a.length};h(i),$("#divDocumentAssign").dialog("close"),$("#divPosition").dialog("close")}):4==d&&(t={"document.tree_path":"^"+n,"document.type":2},a={_id:"序号",name:"案卷名",did:"档号",saveExpireIn:"保存年限","具体地址":"具体地址",position:"位置","社区单位编号":"社区单位编号",num:"件数",page:"页数"},a=JSON.stringify(a),local_api._listUnionUrl({table1:"document",table2:"docProp"},t,"docProp.*,document.did,document.id,document.name","document.did|document.id","document.id=docProp.fid",a,1,-1,$.cookie("appkey"),function(t){t.data&&t.data.length&&$("#export").parent().show(),h(t,4),$("#divDocumentAssign").dialog("close")}))},"取消":function(){$("#divDocumentAssign").dialog("close")}}}),$("#classify").on("click",function(){$("#divDocumentAssign").dialog("open")}),$("#position").on("click",function(){$("#divPosition").dialog("open")}),$("#divPosition").dialog({width:300,maxHeight:400,autoOpen:!1,title:"位置",buttons:{"确定":function(){!function(){var t=$("#qnum").val().trim(),a=$("#lnum").val().trim(),e=$("#jnum").val().trim(),n=$("#cnum").val().trim(),i=$("#ce").val();console.log(t,a,e,n,i);var s={ce:i,u_path:"^"+o};t&&(s.qnum=t),a&&(s.lnum=a),e&&(s.jnum=e),n&&(s.cnum=n),local_api._list("docProp",s,"fid,qnum,lnum,jnum,cnum,ce,name","qnum|lnum|jnum|cnum|ce",1,-1,$.cookie("appkey"),function(t){for(var a={1:"左",0:"右"},e=0;e<t.data.length;e++){var n=t.data[e];t.data[e].position=n.qnum+"区"+n.lnum+"列"+n.jnum+"节"+n.cnum+"层"+a[parseInt(n.ce)]+"侧"}var i={};for(e=0;e<t.data.length;e++){var o=[];if(!i[t.data[e].position]){for(i[t.data[e].position]={position:t.data[e].position};0<t.data.length;e++)t.data[e].position==t.data[0].position&&o.push(t.data[0]);i[ele.position].count=o.length}}var s={data:[]};for(var e in i)s.data.push(i[e]);s.total=s.data.length,h(s,2),$("#divDocumentAssign").dialog("close"),$("#divPosition").dialog("close")})}()},"取消":function(){$("#divPosition").dialog("close")}}});var h=function(t,a){if(t){names=[];for(var e={1:"左",0:"右"},n=0;n<t.data.length;n++)t.data[n]._id=n,4==a?(t.data[n].position="",t.data[n].createdAt=new Date(t.data[n].createdAt).format("yyyy-MM-dd hh:mm:ss"),t.data[n].qnum&&t.data[n].lnum&&t.data[n].jnum&&(t.data[n].position=t.data[n].qnum+"区"+t.data[n].lnum+"列"+t.data[n].jnum+"节"+t.data[n].cnum+"层"+e[parseInt(t.data[n].ce)]+"侧")):5==a&&(t.data[n].createdAt=new Date(t.data[n].createdAt).format("yyyy-MM-dd hh:mm:ss"))}var o=[{mData:"_id",sClass:"ms_left"},{mData:"name",sClass:"ms_left"},{mData:"count",sClass:"center"}];2==a&&(o=[{mData:"_id",sClass:"ms_left"},{mData:"position",sClass:"ms_left"},{mData:"count",sClass:"center"}]),3==a&&(o=[{mData:"_id",sClass:"ms_left"},{mData:"createdAt",sClass:"ms_left"},{mData:"count",sClass:"center"}]),4==a&&(o=[{mData:"_id",sClass:"ms_left"},{mData:"name",sClass:"ms_left"},{mData:"did",sClass:"center"},{mData:"saveExpireIn",sClass:"center"},{mData:"具体地址",sClass:"center"},{mData:"position",sClass:"center"},{mData:"社区单位编号",sClass:"center"},{mData:"num",sClass:"center"},{mData:"page",sClass:"center"}]),5==a&&(o=[{mData:"_id",sClass:"ms_left"},{mData:"operate",sClass:"ms_left"},{mData:"name",sClass:"center"},{mData:"account",sClass:"center"},{mData:"createdAt",sClass:"center"}]);var s={bInfo:!1,bLengthChange:!1,bProcessing:!0,bServerSide:!1,bFilter:!1,bScrollCollapse:!0,bAutoWidth:!0,aaData:t.data,aoColumns:o,bInfo:!0,sPaginationType:"bootstrap",oLanguage:{sProcessing:"正在获取数据，请稍后...",sLengthMenu:"显示 _MENU_ 条",sZeroRecords:"没有您要搜索的内容",sInfo:"从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",sInfoEmpty:"记录数为0",sInfoFiltered:"(全部记录数 _MAX_ 条)",sInfoPostFix:"",sSearch:"搜索",sUrl:"",oPaginate:{sFirst:"第一页",sPrevious:"上一页",sNext:"下一页",sLast:"最后一页"}}};i?(i.fnClearTable(),i.fnAddData(t.data)):i=$("#doc_list").dataTable(s)};$("#dateQuery").on("click",function(){var t=$(".endTime input").val(),a=t+1,e=parseInt($("#timeType").val()),n={};1==e?n={u_path:"^"+o,type:"2"}:2==e&&(n={u_path:"^"+o,type:"2",createdAt:`>${t}&<${a}`}),local_api._list("document",n,"","",1,-1,s,function(t){console.log(t);for(var a=0;a<t.data.length;a++)1==e?t.data[a]._createdAt=new Date(t.data[a].createdAt).format("yyyy"):2==e&&(t.data[a]._createdAt=new Date(t.data[a].createdAt).format("yyyy-MM"));var n={};for(a=0;a<t.data.length;a++)n[t.data[a]._createdAt]?n[t.data[a]._createdAt].count++:n[t.data[a]._createdAt]={count:1,createdAt:t.data[a]._createdAt};var i={data:[]};for(var a in n)i.data.push(n[a]);h(i,3)})}),$("#export").on("click",function(t){var a=document.createElement("a");a.href="/b.xlsx",a.click()})}});