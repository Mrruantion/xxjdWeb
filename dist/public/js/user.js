!function(e){var a={};function t(o){if(a[o])return a[o].exports;var n=a[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,t),n.l=!0,n.exports}t.m=e,t.c=a,t.d=function(e,a,o){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:o})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},t.p="",t(t.s=1)}([,function(e,a){var t,o,n,r,i,s,l,d,c,u="",p=$.cookie("userType"),h="",m="";$(document).ready(function(){function e(){var e=window.innerHeight||$(window).height()-113;$("#user_list_wrapper").css("height",e+"px")}$(window).resize(function(){e()});var a=function(e){var a=[];customers=e.data,e.data.length>0&&(o=o||e.data[0].uid,n=e.data[0].treePath),$.cookie("uid")&&(o=o||$.cookie("uid"),n=$.cookie("tree_path"));for(var t=0;t<e.data.length;t++)a.push(e.data[t].name);var r={view:{showIcon:!0},check:{enable:!1,chkStyle:"checkbox"},data:{simpleData:{enable:!0}},callback:{onClick:function(e,a,t){if(parseInt(t.id)>0){o=t.id,n=t.treePath,m=t.titleName;var r=n.split(","),i=[];h="";for(var s=2;s<r.length;s++)i.push(r[s]);local_api._list("user",{id:i.join("|")},"name","",0,-1,$.cookie("appkey"),function(e){e.data.forEach(function(e){h+=e.name}),console.log(h,"title")}),n==$.cookie("tree_path")&&2==p&&(o=$.cookie("uid")),selectNode=t,l=t.name,$("#selCustName").html(l),k(o),y({name:l})}}}},i=[],s=[];for(t=0;t<e.data.length;t++)i.push({open:!1,id:e.data[t].id,treePath:e.data[t].tree_path,pId:e.data[t].pid,name:e.data[t].name,titleName:e.data[t].titleName,icon:"/img/person_icon.png"}),s.push({open:!1,id:e.data[t].id,treePath:e.data[t].tree_path,pId:e.data[t].pid,name:e.data[t].name,titleName:e.data[t].titleName,icon:"/img/person_icon.png"});if($.fn.zTree.init($("#userTree"),r,i),o>0){var d=$.fn.zTree.getZTreeObj("userTree"),c=d.getNodeByParam("id",o,null);if(c){n=c.treePath,l=c.name,m=c.titleName,$("#selCustName").html(l),d.selectNode(c);var u=n.split(","),f=[];for(h="",t=2;t<u.length;t++)f.push(u[t]);local_api._list("user",{id:f.join("|")},"name","",0,-1,$.cookie("appkey"),function(e){e.data.forEach(function(e){h+=e.name}),console.log(h,"title")})}else{for(n=$.cookie("tree_path"),c=d.getNodeByParam("treePath",n,null),n=c.treePath,l=c.name,m=c.titleName,$("#selCustName").html(l),d.selectNode(c),u=n.split(","),f=[],h="",t=2;t<u.length;t++)f.push(u[t]);local_api._list("user",{id:f.join("|")},"name","",0,-1,$.cookie("appkey"),function(e){e.data.forEach(function(e){h+=e.name}),console.log(h,"title")})}void 0!==k&&(k(o),y({name:l}))}};(r=function(){local_api._list("user",{id:">0",userType:1,tree_path:"^"+$.cookie("tree_path")+",|"+$.cookie("tree_path")},"","",1,-1,$.cookie("appkey"),a)})();var k=function(e){var a="";""!==$("#userKey").val()&&(a=$("#userKey").val().trim());var t={};if(""!==a){var o=$("#searchType").val();$("#allNode").is(":checked")||((t=2==$("#userTypeSel").val()?2==p&&e==$.cookie("uid")?{tree_path:n,pid:e,userType:$("#userTypeSel").val()}:{tree_path:n,userType:$("#userTypeSel").val()}:{pid:e,userType:$("#userTypeSel").val()})[o]="^"+a)}else t=2==$("#userTypeSel").val()?2==p&&e==$.cookie("uid")?{tree_path:n,pid:e,userType:$("#userTypeSel").val()}:{tree_path:n,userType:$("#userTypeSel").val()}:{pid:e,userType:$("#userTypeSel").val()};local_api._list("user",t,"id,name,createdAt,roleId,pid,titleName","-createdAt",1,-1,$.cookie("appkey"),_)},_=function(e){names=[],e.data=e.data.filter(function(e){return e.id!=o});for(var a=0;a<e.data.length;a++)e.data[a].createdAt=new Date(e.data[a].createdAt),e.data[a].createdAt=e.data[a].createdAt.format("yyyy-MM-dd"),names.push(e.data[a].name);var n={bInfo:!1,bLengthChange:!1,bProcessing:!0,bServerSide:!1,bFilter:!1,bScrollCollapse:!0,aaData:e.data,aoColumns:[{mData:null,sClass:"center",bSortable:!1,fnRender:function(e){return"<input type='checkbox' value='"+e.aData.id+"'>"}},{mData:"name",sClass:"ms_left"},{mData:"createdAt",sClass:"center"},{mData:null,sClass:"center",bSortable:!1,fnRender:function(e){return"<a href='#' title='编辑'><i class='icon-edit' cust_id='"+e.aData.id+"'></i></a>&nbsp&nbsp<a href='#' title='权限'><i class='icon-key' cust_id='"+e.aData.id+"'></i></a>&nbsp&nbsp<a href='#' title='删除'><i class='icon-remove' cust_id='"+e.aData.id+"' cust_name='"+e.aData.name+"'></i></a>"}}],sDom:"<'row'r>t<'row'<'pull-right'p>>",sPaginationType:"bootstrap",oLanguage:{sUrl:"css/lang.txt"}};t?(t.fnClearTable(),t.fnAddData(e.data)):t=$("#user_list").dataTable(n)},g=setInterval(function(){$("#userKey").on("keypress",function(e){13==e.keyCode&&k(o)}),$("#userTypeSel").on("change",function(){k(o)}),$(document).on("click","#user_list .icon-remove",function(){var e;s=parseInt($(this).attr("cust_id")),l=$(this).attr("cust_name"),e=s,confirm(`你确认删除用户${l}及所有名下信息吗？`)&&local_api._list("user",{tree_path:"^"+e,id:"<>"+e},"id","",1,-1,$.cookie("appkey"),function(a){a.total>0?showTips("err","该客户下有客户记录，无法删除！"):local_api._delete("user",{id:e},$.cookie("appkey"),function(a){0==a.status&&function(e,a){local_api._delete("document",e,$.cookie("appkey"),function(e){showTips("ok","删除成功！"),r()})}({u_path:"^"+e})})}),console.log(s)}),$(document).on("click","#user_list  .icon-edit",function(){v({id:s=parseInt($(this).attr("cust_id"))},"",function(e){var a=e.data.account,t=e.data.name,o=e.data.userType,n=new Date(e.data.createdAt).format("yyyy-MM-dd hh:mm:ss"),r=e.data.titleName;f(1,a,o,t,n,r)}),$("#divaddUser").dialog("option","title","修改用户"),$("#divaddUser").dialog("open"),console.log(s)}),$(document).on("click","#user_list  .icon-key",function(){v({id:s=parseInt($(this).attr("cust_id"))},"",function(e){$("#frmKeyUser input").prop("checked",!1),e.data.role&&function(e){for(var a=e.split(","),t=$('#frmKeyUser input[name != "全选"]'),o=0;o<a.length;o++)for(var n=0;n<t.length;n++)a[o]==$(t[n]).val()&&$(t[n]).prop("checked",!0)}(e.data.role),$("#divKeyUser").dialog("option","title","设置权限"),$("#divKeyUser").dialog("open")}),console.log(s)}),$("#username").on("input",function(e){1==$("#userType").val()?$("#sTitleName").val(h+e.target.value+"电子档案管理系统"):$("#sTitleName").val(m)}),$("#userType").change(function(e){2==e.target.value?$("#sTitleName").val(m):$("#sTitleName").val(h+$("#username").val()+"电子档案管理系统")});var a=["首页","目录","检索","用户管理","系统备份","报表"];$("#menukey1").on("click",function(){$("#menukey input").each(function(e,a){""!=$(a).val()&&roleArr.indexOf($(a).val())>-1&&$(a).prop("checked",$("#menukey1").prop("checked"))})}),$("#menukey input").change(function(){i($("#menukey input"),$("#menukey1"),a)});var t=["上传","新建","移动","重命名","删除","设置属性","文档审核","打印二维码","合并","导入台账"];$("#dockey input").change(function(){i($("#dockey input"),$("#dockey1"),t)}),$("#dockey1").on("click",function(){$("#dockey input").each(function(e,a){""!=$(a).val()&&roleArr.indexOf($(a).val())>-1&&$(a).prop("checked",$("#dockey1").prop("checked"))})});var n=["调用密集柜","文档加锁","访问加锁文档"];function i(e,a,t){for(var o=[],n=0;n<e.length;n++)$(e[n]).prop("checked")&&o.push($(e[n]).val());o.length==t.length?a.prop("checked",!0):a.prop("checked",!1)}$("#otherkey input").change(function(){i($("#otherkey input"),$("#otherkey1"),n)}),$("#otherkey1").on("click",function(){$("#otherkey input").each(function(e,a){""!=$(a).val()&&roleArr.indexOf($(a).val())>-1&&$(a).prop("checked",$("#otherkey1").prop("checked"))})}),$(".ikey").each(function(e,a){""!=$(a).val()&&-1==roleArr.indexOf($(a).val())&&$(a).attr("disabled",!0)}),e(),clearInterval(g)},1e3),T={};T["确认"]=function(){$("#frmUser").valid()&&(2==i?function(){createOperate("新增用户");var e=$("#useraccount").val(),a=$("#password").val(),t=hex_md5(a),i=$("#userType").val(),s=$("#username").val(),l=$("#sTitleName").val(),u=(new Date).format("yyyy-MM-dd hh:mm:ss"),p={name:s,account:e,password:t,userType:i,tree_path:n,createdAt:u,pid:o,titleName:l};local_api._create("user",p,$.cookie("appkey"),function(e){if(1==i){var a=n+","+e.id;local_api._update("user",{id:e.id},{tree_path:a},$.cookie("appkey"),function(e){!function(e,a){local_api._create("document",e,$.cookie("appkey"),function(e){var a=c+","+e.id;local_api._update("document",{id:e.id},{tree_path:a},$.cookie("appkey"),function(e){showTips("ok","新增客户成功!"),r(),$("#divaddUser").dialog("close")})})}({u_path:a,type:0,createdAt:(new Date).format("yyyy-MM-dd hh:mm:ss"),name:s,pid:d})})}else showTips("ok","新增账户成功!"),r(),$("#divaddUser").dialog("close")})}():1==i&&function(e){createOperate("修改用户信息");var a=$("#userType").val(),t={name:$("#username").val(),userType:a,titleName:$("#sTitleName").val()};"*********"!=$("#password").val()&&(t.password=$("#password").val()),t.tree_path=1==a?n+","+e:n,local_api._update("user",{id:e},t,$.cookie("appkey"),function(e){console.log(e),0==e.status&&(showTips("ok","编辑用户成功!"),$("#divaddUser").dialog("close"),r())})}(s))},T["取消"]=function(){$("#divaddUser").dialog("close")},$("#divaddUser").dialog({width:500,maxWidth:"auto",maxHeight:400,autoOpen:!1,buttons:T}),$("#addUser").on("click",function(){$("#divaddUser").dialog("option","title","新增用户"),$("#divaddUser").dialog("open"),f(2,"",1,"","","")}),(T={})["确认"]=function(){!function(){createOperate("设置权限");for(var e=$('#frmKeyUser input[name != "全选"]:checked'),a=[],t=0;t<e.length;t++)a.push($(e[t]).val());local_api._update("user",{id:s},{role:a.join(",")},$.cookie("appkey"),function(e){$("#divKeyUser").dialog("close"),showTips("ok","设置权限成功!")})}()},T["取消"]=function(){$("#divKeyUser").dialog("close")},$("#divKeyUser").dialog({width:600,maxHeight:400,autoOpen:!1,buttons:T}),validator_customer=$("#frmUser").validate({rules:{useraccount:{minlength:3,required:!0,remote:{url:"/exists",type:"get",dataType:"json",data:{auth_code:function(){return $.cookie("appkey")},query_type:function(){return 1},value:function(){return $("#useraccount").val()}}}},password:{minlength:6,required:!0},password2:{minlength:6,required:!0,equalTo:"#password"},username:{minlength:3,required:!0,remote:{url:"/exists",type:"get",dataType:"json",data:{auth_code:function(){return $.cookie("appkey")},query_type:function(){return 2},old_value:function(){return u},value:function(){return $("#username").val().trim()}}}}},messages:{useraccount:{minlength:"登陆账号必须超过3个字符",required:"请输入登陆账号",remote:"登陆账号已存在"},password:{minlength:"登录密码必须超过6个字符",required:"请输入登录密码"},password2:{required:"请输入确认密码",minlength:"确认密码必须超过6个字符",equalTo:"两次输入密码不一致"},username:{minlength:"客户名称必须超过3位",required:"请输入客户名称",remote:"客户名称已存在"}},highlight:function(e){console.log(e)},success:function(e){e.text("OK!").addClass("valid").closest("li").removeClass("error").addClass("success")}})});var f=function(e,a,t,o,n,r){validator_customer.resetForm(),i=e,u=o,1==e?($("#useraccount").attr("disabled","disabled"),$("#password").attr("disabled","disabled"),$("#userType").attr("disabled","disabled"),$("#password").val("*********"),$("#password2").val("*********"),$("#password2").parent().hide(),$("#repassword").show(),$("#createdAt").parent().show(),$("#createdAt").attr("disabled","disabled")):(2==p?($("#userType").attr("disabled","disabled"),setTimeout(function(){$("#userType").val("2")},1e3)):$("#userType").removeAttr("disabled"),$("#useraccount").removeAttr("disabled"),$("#password").removeAttr("disabled"),$("#password").val(""),$("#password2").val(""),$("#password2").parent().show(),$("#repassword").hide(),$("#createdAt").parent().hide()),$("#useraccount").val(a),$("#userType").val(t),$("#username").val(o),$("#createdAt").val(n),$("#sTitleName").val(r)};function v(e,a,t){local_api._get("user",e,a,$.cookie("appkey"),function(e){t(e)})}function y(e){local_api._get("document",e,"",$.cookie("appkey"),function(e){0==e.status&&e.data&&(d=e.data.id,c=e.data.tree_path)})}$("#repassword").on("click",function(e){var a=hex_md5("123456");$("#password").val(a),showTips("ok","重置密码为123456，请点击确认后保存生效!")})}]);