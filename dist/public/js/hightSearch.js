!function(e){var a={};function t(o){if(a[o])return a[o].exports;var i=a[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=a,t.d=function(e,a,o){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:o})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},t.p="",t(t.s=14)}({14:function(e,a){var t=tools.$(".header")[0],o=tools.$(".weiyun-content")[0],i=t.offsetHeight,n=getSearch();$(document).ready(function(){function e(){var e=window.innerHeight||document.documentElement.clientHeight;o.style.height=e-i+"px",$("#searchResult").css("height",e-i-100+"px")}e(),window.onresize=e,local_api._get("document",{u_path:$.cookie("tree_path")},"id",$.cookie("appkey"),function(e){console.log(e),local_api._list("document",{pid:e.data.id},"","id",1,-1,$.cookie("appkey"),function(e){console.log(e,"resall"),$("#selD").empty(),$("#selC").empty();for(var a=0;a<e.data.length;a++){var t=`<option value="${e.data[a].tree_path}">${e.data[a].name}</option>`;$("#selD").append(t)}if(e.data[0]){var o=e.data[0].tree_path.split(","),i=o[o.length-1];local_api._list("document",{pid:i},"","id",1,-1,$.cookie("appkey"),function(e){console.log(e,"resall");for(var a=0;a<e.data.length;a++){var t=`<option value="${e.data[a].tree_path}">${e.data[a].name}</option>`;$("#selC").append(t)}})}})}),$("#selD").change(function(e){var a=e.target.value.split(","),t=a[a.length-1];local_api._list("document",{pid:t},"","id",1,-1,$.cookie("appkey"),function(e){console.log(e,"resall"),$("#selC").empty();for(var a=0;a<e.data.length;a++){var t=`<option value="${e.data[a].tree_path}">${e.data[a].name}</option>`;$("#selC").append(t)}})});var a=[];n.query&&""!=n.query&&(console.log(n.query),$("#search").val(n.query),createOperate("文件检索"),u(n.query,function(e){for(var a="",t=0;t<e.length;t++)""!=e[t]&&(a+=e[t]+"|");var o={id:a=a.slice(0,a.length-1),ispass:1};-1==roleArr.indexOf("访问加锁文档")&&(o.islock="<>2"),local_api._list("document",o,"","",1,10,$.cookie("appkey"),function(e){console.log(e),e.data.length?(r(e.data),p(e.total,1,10,o)):($(".file-list").hide(),$(".g-empty").show())})})),$("#query").click(function(){var e=$("#name").val().trim(),a=$("#onlyId").val().trim(),t=$("#keyword").val().trim();createOperate("文件检索");var o={type:2};(e||t)&&(o.name="^"+(e||t)),a&&(o.did="^"+a),local_api._list("document",o,"","",1,500,$.cookie("appkey"),function(e){for(var a=[],o=0;o<e.data.length;o++)a.push(e.data[o].id);var i={type:3,ispass:1};""!=$("#selC").val()&&(i.tree_path="^"+$("#selC").val()),e.data.length&&(i.pid=a.join("|")),t&&(i.name="^"+t),-1==roleArr.indexOf("访问加锁文档")&&(idObj.islock="<>2"),local_api._list("document",i,"","",1,10,$.cookie("appkey"),function(e){e.data.length?(r(e.data),p(e.total,1,10,i)):($(".file-list").hide(),$(".g-empty").show())})})});var t,l=[];function r(e){if(l.length){for(var a=[],t=0;t<e.length;t++)e[t].tree_addr=c(e[t].pid,l),e[t].pfid=s(l,e[t].pid),a.push(s(l,e[t].pid));local_api._list("docProp",{fid:a.join("|")},"","",1,-1,$.cookie("appkey"),function(a){for(var t=0;t<e.length;t++)for(var o=0;o<a.data.length;o++)a.data[o].fid==e[t].pfid&&(console.log(a.data[o]),e[t]._postion=`${a.data[o].qnum}区${a.data[o].lnum}列${1==a.data[o].ce?"左":"右"}侧${a.data[o].jnum}节${a.data[o].cnum}层${a.data[o].bnum}本`);$(".file-list").empty(),$(".file-list").show(),$(".g-empty").hide(),$(".file-list").append(createFilesHtmls(e)),$(".file-list .file-item>div").on("click",function(e){"BUTTON"!=e.target.nodeName?"A"!=e.target.nodeName&&d(e):g(e)})})}else local_api._list("document",{type:"0|1|2|4",u_path:"^"+$.cookie("tree_path")},"","",1,-1,$.cookie("appkey"),function(a){l=a.data;for(var t=[],o=0;o<e.length;o++)e[o].tree_addr=c(e[o].pid,l),e[o].pfid=s(l,e[o].pid),t.push(s(l,e[o].pid));local_api._list("docProp",{fid:t.join("|")},"","",1,-1,$.cookie("appkey"),function(a){for(var t=0;t<e.length;t++)for(var o=0;o<a.data.length;o++)a.data[o].fid==e[t].pfid&&(console.log(a.data[o]),e[t]._postion=`${a.data[o].qnum}区${a.data[o].lnum}列${1==a.data[o].ce?"左":"右"}侧${a.data[o].jnum}节${a.data[o].cnum}层${a.data[o].bnum}本`);$(".file-list").empty(),$(".file-list").show(),$(".g-empty").hide(),$(".file-list").append(createFilesHtmls(e)),$(".file-list .file-item>div").on("click",function(e){"BUTTON"!=e.target.nodeName?"A"!=e.target.nodeName&&d(e):g(e)})})})}function d(e){e.currentTarget.dataset.filePid;var a=e.currentTarget.dataset.filepath;a="/pdfView?fileid="+e.currentTarget.dataset.fileId,window.open(a,"_blank")}function p(e,a,t,o){var i=Math.ceil(e/t);$("#pageLimit").bootstrapPaginator({currentPage:a,totalPages:i,size:"normal",bootstrapMajorVersion:3,alignment:"right",numberOfPages:6,itemTexts:function(e,a,t){switch(e){case"first":return"首页";case"prev":return"上一页";case"next":return"下一页";case"last":return"末页";case"page":return a}},onPageClicked:function(e,a,t,i){!function(e,a){local_api._list("document",e,"","",a,10,$.cookie("appkey"),function(e){r(e.data)})}(o,i)}})}function c(e,a){for(var t=dataControl.getParentss(a,e).reverse(),o="",i="",n=0;n<t.length;n++)-1==roleArr.indexOf("目录")?o+=`<a href="#">${t[n].name}</a>`+"/":o+=`<a href="/file?fileId=${t[n].id}">${t[n].name}</a>`+"/",i+=`${t[n].name}`+"/";return console.log(o),{str:o,str1:i}}function s(e,a){for(var t,o=0;o<e.length;o++){if(e[o].id==a&&2==e[o].type){t=e[o].id;break}if(e[o].id==a){t=s(e,e[o].pid);break}}return t}function u(e,t){if(a.length){for(var o={},i=0;i<a.length;i++)o[a[i]]=e;f(e,o,t)}else{var n=["id","fid","createdAt"];local_api.getTableColumns("docProp",$.cookie("appkey"),function(o){for(var i={},l=0;l<o.row.length;l++)-1==n.indexOf(o.row[l].Field)&&(a.push(o.row[l].Field),i[o.row[l].Field]=e);f(e,i,t)})}}function f(e,a,t){var o=[];local_api._vlist("docProp",a,"","",1,200,$.cookie("appkey"),function(a){console.log(a.data);for(var i=0;i<a.data.length;i++)o.push(a.data[i].fid);var n={name:e,filetype:e,path:e,size:e,keyword:e};local_api._vlist("document",n,"","",1,200,$.cookie("appkey"),function(e){for(var a=0;a<e.data.length;a++)3==e.data[a].type?o.push(e.data[a].pid):o.push(e.data[a].id);var i={pid:o.join("|"),type:3};local_api._list("document",i,"","",1,-1,$.cookie("appkey"),function(e){for(var a=[],o=0;o<e.data.length;o++)a.push(e.data[o].id);t(a)})})}),console.log(a)}function g(e){console.log(e.target.dataset);var a=e.target.dataset.docprpid;createOperate("打开密集柜"),local_api._get("docProp",{fid:a},"",$.cookie("appkey"),function(e){if(e.data){var a=parseInt(e.data.qnum||0),o=parseInt(e.data.lnum||0),i=parseInt(e.data.jnum||0),n=parseInt(e.data.cnum||0),l=parseInt(e.data.ce||0),r=parseInt(e.data.bnum||1);if(a>0&&o>0&&i>0&&n>0&&l>=0){var d={qu:a,lie:o,jie:i,ceng:n,ce:l,bh:r,name:e.data.did,status:1};local_api._delete("playApp",{id:">0"},$.cookie("appkey"),function(e){local_api._create("playApp",d,$.cookie("appkey"),function(e){var a=e.id;t&&clearInterval(t),t=setInterval(function(){local_api._get("playApp",{id:a},"",$.cookie("appkey"),function(e){1!=e.data.status&&(clearInterval(t),2==e.data.status?showTips("ok","打开成功！"):3==e.data.status?showTips("err","密集柜连接失败，请检查是否已连接！"):showTips("err","打开失败，请重新打开！"))})},1e3)})})}else showTips("err","无位置信息，无法打开密集柜！")}else showTips("err","无位置信息，无法打开密集柜！")})}$("#search").on("keypress",function(e){if(13==e.keyCode){var a=e.target.value.trim();""!=a&&u(a,function(e){for(var a="",t=0;t<e.length;t++)""!=e[t]&&(a+=e[t]+"|");var o={id:a=a.slice(0,a.length-1),ispass:1};-1==roleArr.indexOf("访问加锁文档")&&(o.islock="<>2"),local_api._list("document",o,"","",1,10,$.cookie("appkey"),function(e){console.log(e),e.data.length?(r(e.data),p(e.total,1,10,o)):($(".file-list").hide(),$(".g-empty").show())})})}}),$(document).on("click",".file-title-addr a",function(e){e.stopPropagation()})})}});